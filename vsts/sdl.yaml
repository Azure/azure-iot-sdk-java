name: $(BuildID)_$(BuildDefinitionName)_$(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:.r)
resources:
- repo: self
  clean: true
phases:

### SDL Tasks ###
- phase: SDL
  displayName: SDL Tasks

  condition: succeeded()
  queue:
    name: sdl-java
    timeoutInMinutes: 60
  steps:
  - powershell: ./vsts/manual_checkout.ps1
    displayName: 'GIT checkout'
    env:
      COMMIT_FROM: $(COMMIT_FROM)

  - task: ms.vss-governance-buildtask.governance-build-task-component-detection.ComponentGovernanceComponentDetection@0
    displayName: 'Component Detection'

  - task: securedevelopmentteam.vss-secure-development-tools.build-task-credscan.CredScan@2
    displayName: CredScan
    inputs:
      debugMode: false

  - task: securedevelopmentteam.vss-secure-development-tools.build-task-publishsecurityanalysislogs.PublishSecurityAnalysisLogs@2
    displayName: 'Publish Security Analysis Logs'

  - task: securedevelopmentteam.vss-secure-development-tools.build-task-postanalysis.PostAnalysis@1
    displayName: 'Post Analysis'
    inputs:
      CredScan: true
      FortifySCA: true

  - task: securedevelopmentteam.vss-secure-development-tools.build-task-uploadtotsa.TSAUpload@1
    displayName: 'TSA upload'
    inputs:
      tsaVersion: TsaV2
      codebase: NewOrUpdate
      tsaEnvironment: PROD
      codeBaseName: 'Azure-Iot-SDK-Java-Master'
      notificationAlias: 'timtay@microsoft.com, prmathur@microsoft.com, jasminel@microsoft.com'
      codeBaseAdmins: 'REDMOND\timtay;REDMOND\prmathur;REDMOND\jasminel'
      instanceUrlForTsaV2: MSAZURE
      projectNameMSAZURE: One
      areaPath: 'One\IoT\Platform\Clients\java'
      iterationPath: 'One\IoT\Backlog'
      uploadAPIScan: false
      uploadBinSkim: false
      uploadFxCop: false
      uploadModernCop: false
      uploadPREfast: false
      uploadRoslyn: false
      uploadTSLint: false
